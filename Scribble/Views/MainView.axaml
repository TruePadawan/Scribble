<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Scribble.ViewModels"
             xmlns:controls="using:Scribble.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Scribble.Views.MainView"
             x:DataType="vm:MainViewModel"
             x:Name="Root">
    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainViewModel />
    </Design.DataContext>
    <UserControl.KeyBindings>
        <KeyBinding Gesture="Ctrl+Z" Command="{Binding Undo}" />
        <KeyBinding Gesture="Ctrl+Shift+Z" Command="{Binding Redo}" />
    </UserControl.KeyBindings>
    <!-- Simulate a wide canvas -->
    <!-- Use a RenderTransformOrigin to tell the ScrollViewer to scale from top left -->
    <Panel>
        <ScrollViewer Name="CanvasScrollViewer" HorizontalScrollBarVisibility="Auto">
            <LayoutTransformControl Name="MainCanvasLayoutTransform" LayoutTransform="{Binding ScaleTransform}">
                <Canvas Name="CanvasContainer"
                        Width="{Binding CanvasWidth}"
                        Height="{Binding CanvasHeight}"
                        HorizontalAlignment="Left"
                        Background="Transparent">
                    <controls:SkiaCanvas Name="MainCanvas"
                                         HorizontalAlignment="Left"
                                         CanvasBackground="{Binding BackgroundColor}"
                                         Width="{Binding CanvasWidth}"
                                         Height="{Binding CanvasHeight}"
                                         PointerPressed="MainCanvas_OnPointerPressed"
                                         PointerMoved="MainCanvas_OnPointerMoved"
                                         PointerReleased="MainCanvas_OnPointerReleased"
                                         PointerWheelChanged="MainCanvas_OnPointerWheelChanged"
                                         Strokes="{Binding CanvasStrokes}"
                                         RenderTransformOrigin="0 0" />
                    <!-- COVERS SELECTED ELEMENTS -->
                    <StackPanel Name="SelectionOverlay" Spacing="6" IsVisible="False">
                        <Button CornerRadius="100" BorderThickness="1" BorderBrush="Aquamarine" Height="15" Width="15"
                                Background="Transparent" HorizontalAlignment="Center" />
                        <Border Name="SelectionBorder" BorderThickness="1" BorderBrush="Aquamarine" Width="300"
                                Height="300">
                        </Border>
                    </StackPanel>
                    <Canvas.Styles>
                        <Style Selector="TextBox:focus /template/ Border">
                            <Setter Property="BorderBrush" Value="Gray" />
                        </Style>
                    </Canvas.Styles>
                </Canvas>
            </LayoutTransformControl>
        </ScrollViewer>
        <Border Name="ToolbarContainer"
                Background="#EE2B2B2B"
                CornerRadius="16"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Margin="0,0,0,24"
                Padding="8"
                BoxShadow="0 4 20 0 #60000000">
            <StackPanel Name="Toolbar"
                        Orientation="Horizontal"
                        Spacing="8">
                <StackPanel.Styles>
                    <Style Selector="ToggleButton">
                        <Setter Property="CornerRadius" Value="10" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Padding" Value="8" />
                        <Setter Property="Width" Value="48" />
                        <Setter Property="Height" Value="48" />
                        <Setter Property="Transitions">
                            <Transitions>
                                <BrushTransition Property="Background" Duration="0:0:0.15" />
                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
                            </Transitions>
                        </Setter>
                    </Style>
                    <Style Selector="ToggleButton:pointerover">
                        <Setter Property="Background" Value="#1AFFFFFF" />
                        <Setter Property="RenderTransform" Value="scale(1.1)" />
                    </Style>
                    <Style Selector="ToggleButton:checked">
                        <Setter Property="Background" Value="#33FFFFFF" />
                    </Style>
                    <Style Selector="ToggleButton:checked /template/ ContentPresenter">
                        <Setter Property="Background" Value="#33FFFFFF" />
                    </Style>
                </StackPanel.Styles>
            </StackPanel>
        </Border>

        <Border Name="ToolOptionsContainer"
                Background="#EE2B2B2B"
                CornerRadius="16"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="24, 80, 0, 0"
                Padding="16"
                BoxShadow="0 4 20 0 #60000000"
                IsVisible="False"
                Opacity="0">
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.3" Easing="CubicEaseOut" />
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut" />
                </Transitions>
            </Border.Transitions>
            <Border.Styles>
                <Style Selector="Border[IsVisible=True]">
                    <Setter Property="Opacity" Value="1" />
                    <Setter Property="RenderTransform" Value="translate(0px, 0px)" />
                </Style>
                <Style Selector="Border[IsVisible=False]">
                    <Setter Property="Opacity" Value="0" />
                    <Setter Property="RenderTransform" Value="translate(-20px, 0px)" />
                </Style>

                <!-- Style for controls inside ToolOptions -->
                <Style Selector="Label">
                    <Setter Property="FontSize" Value="12" />
                    <Setter Property="Foreground" Value="#AAAAAA" />
                    <Setter Property="Margin" Value="0,0,0,4" />
                </Style>
                <Style Selector="Slider">
                    <Setter Property="MinWidth" Value="120" />
                </Style>
            </Border.Styles>
            <StackPanel Name="ToolOptions"
                        Spacing="12">
            </StackPanel>
        </Border>
    </Panel>
</UserControl>